<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garden Grow - re-Action Health Technologies</title>
    <link rel="stylesheet" href="css/styles.css">

    <!-- MediaPipe Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
</head>
<body>
    <div id="app">
        <!-- Nature Background Layer -->
        <div id="natureBackground" class="nature-bg"></div>

        <!-- Video feed from webcam (hidden, used for processing) -->
        <video id="webcam" autoplay playsinline></video>

        <!-- Main game canvas (renders everything) -->
        <canvas id="gameCanvas"></canvas>

        <!-- UI Overlay Container -->
        <div id="uiOverlay">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="screen active">
                <div class="screen-content">
                    <img src="assets/images/logo.png" alt="re:Action Health Technologies" class="company-logo">
                    <h1 class="game-title garden-title">Garden Grow!</h1>
                    <p class="instruction-text">Use your hands to help plants grow</p>
                    <div class="hand-demo">
                        <span class="hand-icon garden-icon">üå±</span>
                    </div>
                    <p id="welcomeMessage" class="welcome-message"></p>
                    <button id="startBtn" class="big-button hoverable has-border-progress" data-hover-action="start">
                        <span id="startBtnText">Start Growing</span>
                        <div class="border-progress-track"></div>
                        <div class="border-progress-fill"></div>
                    </button>
                    <p class="camera-hint">Camera access required</p>

                    <!-- Garden Progress Preview -->
                    <div id="gardenProgressPreview" class="garden-preview">
                        <canvas id="gardenPreviewCanvas" width="300" height="100"></canvas>
                        <p id="gardenProgressText" class="garden-progress-text"></p>
                    </div>
                </div>
            </div>

            <!-- Player Select Screen -->
            <div id="playerSelectScreen" class="screen">
                <div class="screen-content">
                    <h2 class="player-select-title">How Many Gardeners?</h2>
                    <p class="instruction-text">Choose how many players</p>
                    <div class="player-select-buttons">
                        <button class="big-button player-select-btn hoverable has-border-progress" data-hover-action="selectOnePlayer">
                            <span>
                                <span class="player-btn-icon">üßë‚Äçüåæ</span>
                                <span class="player-btn-label">1 Player</span>
                            </span>
                            <div class="border-progress-track"></div>
                            <div class="border-progress-fill"></div>
                        </button>
                        <button class="big-button player-select-btn hoverable has-border-progress" data-hover-action="selectTwoPlayers">
                            <span>
                                <span class="player-btn-icon">üßë‚Äçüåæüßë‚Äçüåæ</span>
                                <span class="player-btn-label">2 Players</span>
                            </span>
                            <div class="border-progress-track"></div>
                            <div class="border-progress-fill"></div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mode Select Screen (2P only) -->
            <div id="modeSelectScreen" class="screen">
                <div class="screen-content">
                    <h2 class="mode-select-title">Choose Your Garden</h2>
                    <p class="instruction-text">How would you like to play together?</p>
                    <div class="mode-select-buttons">
                        <button class="big-button mode-select-btn hoverable has-border-progress" data-hover-action="selectCoop">
                            <span>
                                <span class="mode-btn-icon">üß∫</span>
                                <span class="mode-btn-label">Community Garden</span>
                                <span class="mode-btn-desc">Work together, share the harvest</span>
                            </span>
                            <div class="border-progress-track"></div>
                            <div class="border-progress-fill"></div>
                        </button>
                        <button class="big-button mode-select-btn hoverable has-border-progress" data-hover-action="selectCompetitive">
                            <span>
                                <span class="mode-btn-icon">üéÄ</span>
                                <span class="mode-btn-label">Village Fair</span>
                                <span class="mode-btn-desc">Friendly contest, earn ribbons</span>
                            </span>
                            <div class="border-progress-track"></div>
                            <div class="border-progress-fill"></div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Calibration Screen -->
            <div id="calibrationScreen" class="screen">
                <div class="screen-content">
                    <h2 class="calibration-title">Show Your Gardening Hands!</h2>
                    <p class="instruction-text">Hold your hands up so the camera can see them</p>
                    <div id="handStatus">
                        <div class="hand-indicator" id="leftHandIndicator">
                            <span class="hand-label">Left Hand</span>
                            <span class="hand-status">Not detected</span>
                        </div>
                        <div class="hand-indicator" id="rightHandIndicator">
                            <span class="hand-label">Right Hand</span>
                            <span class="hand-status">Not detected</span>
                        </div>
                    </div>
                    <p class="wave-instruction">Wave to start gardening!</p>
                </div>
            </div>

            <!-- Calibration P2 Screen (2-player sequential calibration) -->
            <div id="calibrationP2Screen" class="screen">
                <div class="screen-content">
                    <h2 class="calibration-title calibration-p2-title">Player 2, Join the Garden!</h2>
                    <p class="instruction-text">Now show your hand on the <strong>left side</strong> of the screen</p>
                    <div class="calibration-players">
                        <div class="calibration-player p1-ready">
                            <span class="cal-player-icon" style="color: #FF8C42;">‚úã</span>
                            <span class="cal-player-label">Player 1</span>
                            <span class="cal-player-status">Ready!</span>
                        </div>
                        <div class="calibration-player p2-waiting" id="p2CalStatus">
                            <span class="cal-player-icon" style="color: #4A90D9;">‚úã</span>
                            <span class="cal-player-label">Player 2</span>
                            <span class="cal-player-status" id="p2CalStatusText">Waiting...</span>
                        </div>
                    </div>
                    <p class="wave-instruction">Both hands detected? Let's grow!</p>
                </div>
            </div>

            <!-- Chapter Intro Screen -->
            <div id="chapterIntroScreen" class="screen chapter-screen">
                <div class="screen-content chapter-content">
                    <span class="chapter-icon">üå±</span>
                    <p class="chapter-number">Chapter 1</p>
                    <h2 class="chapter-title">The Forgotten Garden</h2>
                    <p class="chapter-intro-text">An old garden has been waiting for someone special...</p>
                    <p class="chapter-goal-label">Your Goal:</p>
                    <p class="chapter-goal">Plant your first seeds</p>
                    <div class="chapter-progress-bar">
                        <div class="chapter-progress-fill"></div>
                    </div>
                    <p class="tap-to-continue">Tap anywhere to continue</p>
                </div>
            </div>

            <!-- Chapter Complete Screen -->
            <div id="chapterCompleteScreen" class="screen chapter-screen celebration">
                <div class="screen-content chapter-content">
                    <span class="complete-icon">üéâ</span>
                    <h2 class="complete-title">Chapter Complete!</h2>
                    <p class="chapter-reward">The garden is waking up!</p>
                    <p class="unlock-message"></p>
                    <div class="chapter-progress-bar">
                        <div class="chapter-progress-fill"></div>
                    </div>
                    <p class="tap-to-continue">Tap anywhere to continue</p>
                </div>
            </div>

            <!-- Challenge Intro Screen -->
            <div id="challengeIntroScreen" class="screen">
                <div class="screen-content">
                    <h2 class="level-label">Level <span id="levelNumber">1</span></h2>
                    <div id="challengeDisplay" class="challenge-text">
                        <!-- Challenge text will be inserted here -->
                    </div>
                    <div id="challengeColors" class="challenge-colors">
                        <!-- Plant indicators will be inserted here -->
                    </div>
                    <p class="ready-text">Get Ready to Grow!</p>
                    <div class="countdown" id="countdown">3</div>
                </div>
            </div>

            <!-- In-Game HUD (1-player default) -->
            <div id="gameHUD" class="hud hidden">
                <div class="hud-top">
                    <div class="hud-item timer-display">
                        <span class="hud-label">Time</span>
                        <span id="timerValue" class="hud-value">60</span>
                    </div>
                    <div class="hud-item challenge-display">
                        <span id="currentChallenge" class="challenge-mini"></span>
                    </div>
                    <div class="hud-item score-display">
                        <span class="hud-label">Plants</span>
                        <span id="scoreValue" class="hud-value">0</span>
                    </div>
                </div>
                <div class="hud-progress">
                    <div id="progressBar" class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <span id="progressText" class="progress-text">0 / 3</span>
                </div>
            </div>

            <!-- 2-Player Competitive HUD -->
            <div id="gameHUD2P" class="hud hud-2p hidden">
                <div class="hud-top hud-top-2p">
                    <div class="hud-item hud-player-score hud-p2-score">
                        <span class="hud-label hud-label-p2">Player 2</span>
                        <span id="p2ScoreValue" class="hud-value hud-value-p2">0</span>
                        <div class="hud-player-progress">
                            <div id="p2ProgressBar" class="progress-bar progress-bar-p2">
                                <div id="p2ProgressFill" class="progress-fill progress-fill-p2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="hud-item timer-display timer-display-center">
                        <span class="hud-label">Time</span>
                        <span id="timerValue2P" class="hud-value">60</span>
                    </div>
                    <div class="hud-item hud-player-score hud-p1-score">
                        <span class="hud-label hud-label-p1">Player 1</span>
                        <span id="p1ScoreValue" class="hud-value hud-value-p1">0</span>
                        <div class="hud-player-progress">
                            <div id="p1ProgressBar" class="progress-bar progress-bar-p1">
                                <div id="p1ProgressFill" class="progress-fill progress-fill-p1"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Round End Screen (1P and Co-op) -->
            <div id="roundEndScreen" class="screen">
                <div class="screen-content">
                    <h2 id="roundResult" class="result-title">Beautiful Garden!</h2>
                    <div class="score-summary">
                        <div class="final-score">
                            <span class="score-label">Score</span>
                            <span id="finalScore" class="score-number">0</span>
                        </div>
                        <div class="plants-grown">
                            <span class="grown-label">Plants Grown</span>
                            <span id="plantsGrown" class="grown-number">0</span>
                        </div>
                    </div>
                    <p id="encouragementText" class="encouragement-text"></p>
                    <div class="end-buttons">
                        <button id="nextLevelBtn" class="big-button primary hoverable has-border-progress" data-hover-action="nextLevel">
                            <span>Keep Growing</span>
                            <div class="border-progress-track"></div>
                            <div class="border-progress-fill"></div>
                        </button>
                        <button id="playAgainBtn" class="big-button secondary hoverable has-border-progress" data-hover-action="playAgain">
                            <span>Start Over</span>
                            <div class="border-progress-track"></div>
                            <div class="border-progress-fill"></div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Competitive Round End Screen (2P) -->
            <div id="roundEndScreen2P" class="screen">
                <div class="screen-content">
                    <h2 class="result-title result-title-2p">Village Fair Results!</h2>
                    <div class="ribbon-results">
                        <div class="ribbon-card ribbon-p1" id="ribbonP1">
                            <span class="ribbon-icon">üéÄ</span>
                            <span class="ribbon-player-label" style="color: #FF8C42;">Player 1</span>
                            <span class="ribbon-score" id="ribbonP1Score">0</span>
                            <span class="ribbon-title" id="ribbonP1Title">Blue Ribbon</span>
                        </div>
                        <div class="ribbon-card ribbon-p2" id="ribbonP2">
                            <span class="ribbon-icon">üéÄ</span>
                            <span class="ribbon-player-label" style="color: #4A90D9;">Player 2</span>
                            <span class="ribbon-score" id="ribbonP2Score">0</span>
                            <span class="ribbon-title" id="ribbonP2Title">Red Ribbon</span>
                        </div>
                    </div>
                    <p id="encouragementText2P" class="encouragement-text">Both gardens are blooming beautifully!</p>
                    <div class="end-buttons">
                        <button id="nextLevelBtn2P" class="big-button primary hoverable has-border-progress" data-hover-action="nextLevel">
                            <span>Keep Growing</span>
                            <div class="border-progress-track"></div>
                            <div class="border-progress-fill"></div>
                        </button>
                        <button id="playAgainBtn2P" class="big-button secondary hoverable has-border-progress" data-hover-action="playAgain">
                            <span>Start Over</span>
                            <div class="border-progress-track"></div>
                            <div class="border-progress-fill"></div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Button (always visible) -->
        <button id="settingsBtn" class="settings-button hoverable" data-hover-action="openSettings">
            <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
            </svg>
            <div class="hover-progress-ring">
                <svg viewBox="0 0 100 100">
                    <circle class="hover-progress-bg" cx="50" cy="50" r="45"/>
                    <circle class="hover-progress-fill" cx="50" cy="50" r="45"/>
                </svg>
            </div>
        </button>

        <!-- Settings Overlay -->
        <div id="settingsOverlay" class="settings-overlay hidden">
            <div class="settings-panel">
                <button id="closeSettingsX" class="close-x-btn hoverable" data-hover-action="closeSettings">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
                <h2 class="settings-title">Settings</h2>

                <div class="settings-section">
                    <h3 class="settings-section-title">Sound</h3>

                    <div class="setting-row">
                        <label class="setting-label">Sound Effects</label>
                        <button id="soundToggle" class="toggle-button hoverable" data-hover-action="toggleSound">
                            <span class="toggle-state">ON</span>
                        </button>
                    </div>

                    <div class="setting-row">
                        <label class="setting-label">Volume</label>
                        <div class="volume-control">
                            <button id="volumeDown" class="volume-btn hoverable" data-hover-action="volumeDown">-</button>
                            <div id="volumeSlider" class="volume-bar volume-slider">
                                <div id="volumeFill" class="volume-fill" style="width: 70%"></div>
                                <div id="volumeHandle" class="volume-handle"></div>
                            </div>
                            <button id="volumeUp" class="volume-btn hoverable" data-hover-action="volumeUp">+</button>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Display</h3>

                    <div class="setting-row">
                        <label class="setting-label">Contrast</label>
                        <div class="contrast-options">
                            <button id="contrastNormal" class="contrast-btn hoverable active" data-hover-action="contrastNormal">
                                Normal
                            </button>
                            <button id="contrastHigh" class="contrast-btn hoverable" data-hover-action="contrastHigh">
                                High
                            </button>
                            <button id="contrastMax" class="contrast-btn hoverable" data-hover-action="contrastMax">
                                Maximum
                            </button>
                        </div>
                    </div>

                    <div class="setting-row setting-row-vertical">
                        <label class="setting-label">Background</label>
                        <div class="background-options">
                            <button id="bgNone" class="bg-btn bg-preview hoverable" data-hover-action="bgNone">
                                <div class="bg-preview-box bg-preview-none"></div>
                                <span>None</span>
                            </button>
                            <button id="bgGarden" class="bg-btn bg-preview hoverable active" data-hover-action="bgGarden">
                                <div class="bg-preview-box bg-preview-garden"></div>
                                <span>Garden</span>
                            </button>
                            <button id="bgBeach" class="bg-btn bg-preview hoverable" data-hover-action="bgBeach">
                                <div class="bg-preview-box bg-preview-beach"></div>
                                <span>Beach</span>
                            </button>
                            <button id="bgForest" class="bg-btn bg-preview hoverable" data-hover-action="bgForest">
                                <div class="bg-preview-box bg-preview-forest"></div>
                                <span>Forest</span>
                            </button>
                            <button id="bgSky" class="bg-btn bg-preview hoverable" data-hover-action="bgSky">
                                <div class="bg-preview-box bg-preview-sky"></div>
                                <span>Sky</span>
                            </button>
                        </div>
                    </div>
                </div>

                <button id="closeSettingsBtn" class="settings-close-btn hoverable" data-hover-action="closeSettings">
                    <span>Close</span>
                    <div class="hover-progress-bar"></div>
                </button>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingOverlay" class="loading">
            <div class="loading-spinner garden-spinner"></div>
            <p class="loading-text">Preparing the garden...</p>
        </div>
    </div>

    <!-- Game Scripts -->
    <script src="js/audio.js"></script>
    <script src="js/dda.js"></script>
    <script src="js/garden.js"></script>
    <script src="js/challenges.js"></script>
    <script src="js/story.js"></script>
    <script src="js/handTracking.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
